
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EduGenius platform (student, teacher, or administrator).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The role of the user (e.g., student, teacher, administrator)."
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "role"
      ]
    },
    "Class": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Class",
      "type": "object",
      "description": "Represents a class or course within the EduGenius platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the class."
        },
        "name": {
          "type": "string",
          "description": "The name of the class (e.g., 'Math 101')."
        },
        "description": {
          "type": "string",
          "description": "A description of the class."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Subject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subject",
      "type": "object",
      "description": "Represents a subject or topic taught within the EduGenius platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subject."
        },
        "name": {
          "type": "string",
          "description": "The name of the subject (e.g., 'Mathematics', 'History')."
        },
        "description": {
          "type": "string",
          "description": "A description of the subject."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:1 Subject)"
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a specific course or lesson within a subject.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course."
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to Subject. (Relationship: Subject 1:N Course)"
        },
        "teacherId": {
          "type": "string",
          "description": "The ID of the teacher who created the course."
        },
        "title": {
          "type": "string",
          "description": "The title of the course (e.g., 'Introduction to Algebra')."
        },
        "content": {
          "type": "string",
          "description": "The content or material of the course (e.g., text, videos, links)."
        }
      },
      "required": [
        "id",
        "subjectId",
        "teacherId",
        "title",
        "content"
      ]
    },
    "ScheduleEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ScheduleEvent",
      "type": "object",
      "description": "Represents an event in the schedule, such as a class or a meeting.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the event." },
        "date": { "type": "string", "format": "date", "description": "The date of the event." },
        "startTime": { "type": "string", "format": "time", "description": "The start time of the event." },
        "endTime": { "type": "string", "format": "time", "description": "The end time of the event." },
        "subject": { "type": "string", "description": "The name of the subject for the event." },
        "class": { "type": "string", "description": "The name of the class attending the event." },
        "teacherId": { "type": "string", "description": "The ID of the teacher responsible for the event." },
        "type": { "type": "string", "enum": ["en-salle", "en-ligne"], "description": "The type of the event." },
        "status": { "type": "string", "enum": ["planifié", "reporté", "annulé", "effectué"], "description": "The status of the event." },
        "conferenceLink": { "type": "string", "format": "uri", "description": "Link to the online conference if applicable." }
      },
      "required": ["id", "date", "startTime", "endTime", "subject", "class", "teacherId", "type", "status"]
    },
    "ClassStudent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClassStudent",
      "type": "object",
      "description": "Represents the association between a class and a student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ClassStudent relationship."
        },
        "classId": {
          "type": "string",
          "description": "Reference to Class. (Relationship: Class 1:N ClassStudent)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to Student. (Relationship: Student 1:N ClassStudent)"
        }
      },
      "required": [
        "id",
        "classId",
        "studentId"
      ]
    },
    "ClassTeacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClassTeacher",
      "type": "object",
      "description": "Represents the assignment of a teacher to a class.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ClassTeacher assignment."
        },
        "classId": {
          "type": "string",
          "description": "Reference to Class. (Relationship: Class 1:N ClassTeacher)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to Teacher. (Relationship: Teacher 1:N ClassTeacher)"
        }
      },
      "required": [
        "id",
        "classId",
        "teacherId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Accessible to the user and administrators.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/classes/{classId}",
        "definition": {
          "entityName": "Class",
          "schema": {
            "$ref": "#/backend/entities/Class"
          },
          "description": "Stores class information. Accessible to administrators and teachers assigned to the class.",
          "params": [
            {
              "name": "classId",
              "description": "The unique identifier of the class."
            }
          ]
        }
      },
      {
        "path": "/subjects/{subjectId}",
        "definition": {
          "entityName": "Subject",
          "schema": {
            "$ref": "#/backend/entities/Subject"
          },
          "description": "Stores subject information. Includes `teacherId` for authorization.",
          "params": [
            {
              "name": "subjectId",
              "description": "The unique identifier of the subject."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores course information. Accessible to authenticated users, with write access controlled by `teacherId`.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier of the course."
            }
          ]
        }
      },
      {
        "path": "/schedule/{eventId}",
        "definition": {
          "entityName": "ScheduleEvent",
          "schema": {
            "$ref": "#/backend/entities/ScheduleEvent"
          },
          "description": "Stores schedule events. Write access controlled by `teacherId`.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier of the schedule event."
            }
          ]
        }
      },
      {
        "path": "/class_students/{classStudentId}",
        "definition": {
          "entityName": "ClassStudent",
          "schema": {
            "$ref": "#/backend/entities/ClassStudent"
          },
          "description": "Represents the relationship between a class and a student.",
          "params": [
            {
              "name": "classStudentId",
              "description": "The unique identifier for the ClassStudent relationship."
            }
          ]
        }
      },
      {
        "path": "/class_teachers/{classTeacherId}",
        "definition": {
          "entityName": "ClassTeacher",
          "schema": {
            "$ref": "#/backend/entities/ClassTeacher"
          },
          "description": "Represents the assignment of a teacher to a class.",
          "params": [
            {
              "name": "classTeacherId",
              "description": "The unique identifier for the ClassTeacher assignment."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "admin_role",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates admin role for user. Existence of document implies admin rights.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support EduGenius's role-based access control and feature set, focusing on Authorization Independence and Structural Segregation.\n\n**Authorization Independence:** Access control is enforced without relying on hierarchical `get()` calls. The key is denormalization. For example, the `Course` collection is at the root level, and each course document contains a `teacherId`. This allows security rules to authorize writes directly on the course document without fetching the parent `Subject` document.\n\n**Structural Segregation:**  Data with differing access requirements are stored in separate collections. User data, accessible only to the user and admins, is stored under `/users/{userId}`. Class, Subject and Course data are stored at the root level. All documents within a collection share the same security rules, simplifying rule definition.\n\n**QAPs Support:** List operations are secured by the structure. Listing users is restricted based on admin roles (checking the existence of `/roles_admin/{userId}`).  Classes, Subjects and Courses can be listed based on the user's role and explicit permissions defined using security rules within each collection.\n"
  }
}

    